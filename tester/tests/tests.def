#ifndef TESTS_DEF
# define TESTS_DEF

#include "../tester.h"

#define SHELL_TEST(__expr, __stdin, __stdout, __stderr, __status) \
{ \
	t_eval_test test = (t_eval_test){ \
		.expr = stringbuf_from(__expr), \
		.stdin = stringbuf_from(__stdin), \
		.stdout = stringbuf_from(__stdout), \
		.stderr = stringbuf_from(__stderr), \
		.status = __status, \
		.envp = calloc(1, sizeof(char **)) \
	}; \
	++total; \
	passed += test_run(&test); \
	test_free(&test); \
}

#define DO_TEST(__label, ...) \
static int test_##__label(void) \
{ \
	int	passed; \
	int	total; \
	ft_dprintf(2, "Running tests %s...\n", #__label); \
	passed = 0; \
	total = 0; \
	{ __VA_ARGS__; } \
	ft_dprintf(2, "%s tests [%d/%d passed]\n", #__label, passed, total); \
	return (passed); \
}

#endif // TESTS_DEF
